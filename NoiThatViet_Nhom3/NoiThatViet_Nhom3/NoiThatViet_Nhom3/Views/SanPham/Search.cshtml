@model List<NoiThatViet_Nhom3.Models.SanPham>
@{
    ViewBag.Title = "Search";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Kết quả tìm kiếm</h2>

@if (Model.Any())
{
    <div class="row">
        @foreach (var item in Model)
        {
            <div class="col-md-3">
                <div class="card-wrapper">
                    <div class="card">
                        <img class="card-img-top" src="@Url.Content(item.HinhAnh)" alt="@item.TenSanPham" />
                        <div class="card-fixed">
                            <h5 class="card-title">@Html.DisplayFor(modelItem => item.TenSanPham)</h5>
                            <p class="card-text">Giá: @item.Gia.ToString("N0")</p>
                            @{
                                var cleanId = item.MaSanPham.Trim().Replace("%20", "");
                            }
                            <button class="btn btn-link addToWishlistBtn" data-product-id="@item.MaSanPham" title="Thêm vào WishList">
                                <span class="bi bi-heart"></span> <!-- Biểu tượng trái tim -->
                            </button>
                            <a href="javascript:void(0);" class="btn btn-primary addToCartBtn" data-product-id="@item.MaSanPham">Thêm vào giỏ hàng</a>
                            <a href="@Url.Action("Detail", "SanPham", new { id = item.MaSanPham.Trim() })" class="btn btn-secondary">Xem thêm</a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}
else
{
    <p>Không tìm thấy vật phẩm phù hợp</p>
}

@section scripts {
    <style>
        .toast-success {
            background-color: #28a745 !important; /*Nền màu xanh*/
            color: #fff !important; /*Font màu trắng*/
        }

        .toast-error {
            background-color: #dc3545 !important; /*Nền màu đỏ*/
            color: #fff !important;
        }
    </style>
    <script>
            $(document).ready(function () {
        // Toastr Options
        toastr.options = {
            "closeButton": true,
            "positionClass": "toast-bottom-right",
            "progressBar": true,
            "timeOut": "3000", // 3s
        };

        // Handler for adding item to wishlist
        $(".addToWishlistBtn").click(function () {
            var productId = $(this).data("product-id");

            $.ajax({
                url: "/SanPham/AddToWishList",
                type: "POST",
                data: { id: productId },
                success: function (result) {
                    if (result.success) {
                        toastr.success("Thêm sản phẩm vào Wishlist thành công!");
                        $(".wishlist-count").text(result.wishlistCount);
                    } else {
                        toastr.error(result.message);
                    }
                },
            });
        });

        // Handler for adding item to cart
        $(".addToCartBtn").click(function () {
            var productId = $(this).data("product-id");

            $.ajax({
                url: "@Url.Action("AddToCart", "Cart")",
                type: "POST",
                data: { id: productId },
                success: function (response) {
                    if (response.success) {
                        // Update cart item count on success
                        $(".cart-item-count").text(response.cartItemCount);

                        // Hiển thị thông báo thành công
                        toastr.success(response.message);
                    } else {
                        // Hiển thị thông báo lỗi
                        toastr.error(response.message);
                    }
                },
            });
        });
    });
    </script>
}
